<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© - Ø±Ù…Ø¶Ø§Ù† 1447Ù‡Ù€ / 2026Ù…</title>
  <style>
    *{box-sizing:border-box}
    body{font-family: Arial, sans-serif;background:#f6f7fb;padding:24px;margin:0;}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:#fff;border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.08);margin-bottom:18px;}
    h1{margin:0 0 10px 0;text-align:center}
    .muted{color:#666;text-align:center;margin:0 0 14px 0}

    button{
      width:100%;
      background:#6c63ff;color:#fff;border:0;border-radius:12px;
      padding:14px 16px;font-size:18px;font-weight:700;cursor:pointer;
      margin-top:14px;transition: all .25s ease;
    }
    button:disabled{opacity:.6;cursor:not-allowed}
    button:hover:not(:disabled){
      background:#5a54e6;transform: translateY(-1px);
      box-shadow:0 6px 14px rgba(0,0,0,.15);
    }

    .msg{margin-top:14px;padding:12px 14px;border-radius:12px;font-weight:700;text-align:center;display:none;}
    .ok{background:#e8fff1;color:#0a6b2b;display:block}
    .err{background:#ffecec;color:#a30000;display:block}
    .hidden{display:none !important;}

    .topbar{
      display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;
      padding:10px 0 0 0;
    }
    .pill{
      background:#f1f3ff;color:#3b37b8;border-radius:999px;padding:8px 12px;font-weight:700;
      font-size:14px;
    }
    .hr{height:1px;background:#eee;margin:12px 0}

    .q{
      border:1px solid #eef0f6;border-radius:14px;padding:12px;margin:10px 0;background:#fff;
      box-shadow:0 5px 14px rgba(0,0,0,.045);position:relative;overflow:hidden;
    }
    .q-num{
      position:absolute;top:10px;left:12px;font-size:20px;font-weight:900;
      color:rgba(108,99,255,.10);line-height:1;user-select:none;pointer-events:none;
    }
    .q-title{font-weight:900;margin:0 0 10px 0;font-size:15px;line-height:1.75;padding-left:36px;}
    .opts{display:grid;gap:8px}
    .opt input{display:none}
    .opt{
      display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;
      border:1px solid #e8eaf2;border-radius:12px;background:#fafbff;cursor:pointer;transition: all .18s ease;
    }
    .opt:hover{transform: translateY(-1px);box-shadow:0 10px 18px rgba(0,0,0,.06);border-color:#d8dcff;}
    .opt .txt{font-weight:800;color:#222;line-height:1.7;flex:1;font-size:14px;}
    .opt .mark{
      width:22px;height:22px;border-radius:999px;border:2px solid #cfd3ff;
      display:flex;align-items:center;justify-content:center;font-weight:900;color:#fff;flex:0 0 auto;font-size:14px;
    }
    .opt.selected{background:#eef0ff;border-color:#6c63ff;box-shadow:0 10px 22px rgba(108,99,255,.18);}
    .opt.selected .mark{background:#6c63ff;border-color:#6c63ff;}

    .small{font-size:13px;color:#666;text-align:center;margin-top:10px}

    /* âœ… Deadline line ÙˆØ§Ø¶Ø­ */
    #deadlineLine{
      display:block;
      margin:10px 0 4px 0;
      text-align:center;

      color:#111 !important;
      font-weight:900 !important;
      font-size:15px !important;

      background:#fff3cd;
      border:1px solid #f0c36d;
      padding:10px 14px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
    }
    #deadlineLine .date{
      display:block;
      margin-top:6px;
      color:#c62828;
      font-weight:900;
      font-size:16px;
    }

    .kv{
      display:grid;grid-template-columns: 160px 1fr;gap:10px 14px;align-items:center;margin-top:14px;
      background:#fafafa;border:1px solid #eee;border-radius:14px;padding:14px;
    }
    .k{font-weight:800;color:#333}
    .v{font-weight:700;color:#222;word-break:break-word}
    .greenBtn{background:#1f8b4c}
    .greenBtn:hover{background:#17733f}

    .q.missing{border:2px solid #e53935 !important;box-shadow:0 8px 18px rgba(229,57,53,.12) !important;}
    .q.missing .q-title{ color:#b71c1c; }

    @keyframes shake {0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}
    .shake { animation: shake .35s ease; }
    @keyframes shakeMsg {0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}}
    .shakeMsg { animation: shakeMsg .3s ease; }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="card" id="gateCard">
      <h1>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø«Ù‚Ø§ÙÙŠØ© Ù„Ø´Ù‡Ø± Ø±Ù…Ø¶Ø§Ù† 1447Ù‡Ù€ / 2026Ù…</h1>
      <div class="muted">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...</div>
      <div class="msg" id="gateMsg"></div>
      <button id="backBtn" class="hidden">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div class="card hidden" id="quizCard">
      <div class="topbar">
        <div class="pill" id="who"></div>
        <div class="pill">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: <span id="passPct">70</span>%</div>
        <div class="pill">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: <span id="qCount">0</span></div>
      </div>
   <div id="deadlineLine">
        â³ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:
        <span class="date">26 ÙØ¨Ø±Ø§ÙŠØ± 2026 - 12:00 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„</span>
      </div>

      <div class="hr"></div>
   
      <div id="questions"></div>

      <button id="btnSubmit">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
      <div class="msg" id="quizMsg"></div>
      <div class="small">ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø© ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.</div>
    </div>

    <div class="card hidden" id="approvedCard">
      <h1>ØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© âœ…</h1>
      <div class="muted">Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ğŸŒŸ</div>

      <div class="kv">
        <div class="k">Ø§Ù„Ø§Ø³Ù…</div>         <div class="v" id="apName">-</div>
        <div class="k">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ</div>  <div class="v" id="apCivil">-</div>
        <div class="k">Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚</div>   <div class="v" id="apBox">-</div>
        <div class="k">Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</div>  <div class="v" id="apPhone">-</div>
      </div>

      <div class="msg ok" style="display:block" id="approvedMsg">
        âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ğŸŒŸ
      </div>

      <button id="approvedBtn" type="button" class="greenBtn">ØªÙ…</button>
    </div>

  </div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwhdO_Ye6WivgCQyMTgEHrvNQOuEv6RJ9qBLCy-Vrhv_6BUhiCMV_m9kv82V3nYebk/exec";
  const PASS_PERCENT = 70;
  const QUIZ_ID = "RAMADAN_1447_2026_V2";

  // âœ… Ù‚ÙÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ Ù†Ù‡Ø§ÙŠØ© ÙŠÙˆÙ… 26 ÙØ¨Ø±Ø§ÙŠØ± (ØªÙˆÙ‚ÙŠØª Ø§Ù„ÙƒÙˆÙŠØª +03:00)
  // ÙŠØ¹Ù†ÙŠ Ø¨Ø¯Ø¡Ù‹Ø§ Ù…Ù† 27 ÙØ¨Ø±Ø§ÙŠØ± 00:00 ÙŠØµØ¨Ø­ Ù…ØºÙ„Ù‚
  const DEADLINE_TS = Date.parse("2026-02-27T00:00:00+03:00");

  function isClosedNow(){
    return Date.now() >= DEADLINE_TS;
  }

  function updateDeadlineState(){
    const btn = $("btnSubmit");
    const msgEl = $("quizMsg");

    if (!btn) return;

    if (isClosedNow()){
      btn.disabled = true;
      btn.textContent = "Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª";
      showMsg(msgEl, false, "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù†ØªÙ‡Ù‰ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.");
    } else {
      // Ù„Ùˆ Ù„Ø³Ù‡ Ù…ÙØªÙˆØ­ Ø®Ù„ÙŠ Ø§Ù„Ø²Ø± Ø·Ø¨ÙŠØ¹ÙŠ (Ù„Ùˆ ÙƒØ§Ù† Ø§ØªÙ‚ÙÙ„ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ Ù„Ø£ÙŠ Ø³Ø¨Ø¨)
      btn.disabled = false;
      btn.textContent = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª";
    }
  }

  // "ØµØ­" = a ØŒ "Ø®Ø·Ø£" = b
  const QUESTIONS = [
    // 15 MCQ
    {id:"q1", text:"Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰: ï´¿ÙˆÙØ§ØªÙ‘ÙÙ‚ÙÙˆØ§ ÙÙØªÙ’Ù†ÙØ©Ù‹ Ù„ÙØ§ ØªÙØµÙÙŠØ¨ÙÙ†Ù‘Ù Ø§Ù„Ù‘ÙØ°ÙÙŠÙ†Ù Ø¸ÙÙ„ÙÙ…ÙÙˆØ§ Ù…ÙÙ†ÙƒÙÙ…Ù’ Ø®ÙØ§ØµÙ‘ÙØ©Ù‹ï´¾ ÙŠØ¯Ù„ Ø¹Ù„Ù‰:", choices:[
      {label:"Ø£) Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙƒÙØ§Ø±", value:"a"},
      {label:"Ø¨) Ø£Ù† Ø§Ù„ÙØªÙ†Ø© ØªØ¹Ù… Ø§Ù„ØµØ§Ù„Ø­ ÙˆØ§Ù„Ø·Ø§Ù„Ø­", value:"b"},
      {label:"Ø¬) Ø£Ù† Ø§Ù„Ø¸Ù„Ù… ÙØ±Ø¯ÙŠ Ù„Ø§ Ø¬Ù…Ø§Ø¹ÙŠ", value:"c"},
      {label:"Ø¯) Ø£Ù† Ø§Ù„ÙØªÙ†Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙŠÙ†", value:"d"},
    ], answer:"b"},
    {id:"q2", text:"Ù…Ø¹Ù†Ù‰ Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰: ï´¿ÙˆÙØ§Ù„ØµÙ‘ÙØ¨Ù’Ø­Ù Ø¥ÙØ°ÙØ§ ØªÙÙ†ÙÙÙ‘ÙØ³Ùï´¾:", choices:[
      {label:"Ø£) Ø£Ø¶Ø§Ø¡", value:"a"},
      {label:"Ø¨) Ø§Ù…ØªØ¯ Ø¶ÙˆØ¤Ù‡", value:"b"},
      {label:"Ø¬) Ø§Ø±ØªÙØ¹", value:"c"},
      {label:"Ø¯) Ø¸Ù‡Ø± ÙØ¬Ø£Ø©", value:"d"},
    ], answer:"b"},
    {id:"q3", text:"Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¨Ù€ Ø§Ù„ÙƒÙˆØ«Ø± ÙÙŠ Ø³ÙˆØ±Ø© Ø§Ù„ÙƒÙˆØ«Ø± Ø¹Ù†Ø¯ Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ù…ÙØ³Ø±ÙŠÙ†:", choices:[
      {label:"Ø£) Ø§Ù„Ø®ÙŠØ± Ø§Ù„ÙƒØ«ÙŠØ± ÙÙ‚Ø·", value:"a"},
      {label:"Ø¨) Ù†Ù‡Ø± ÙÙŠ Ø§Ù„Ø¬Ù†Ø©", value:"b"},
      {label:"Ø¬) Ø§Ù„Ù‚Ø±Ø¢Ù†", value:"c"},
      {label:"Ø¯) Ø§Ù„Ù†Ø¨ÙˆØ©", value:"d"},
    ], answer:"b"},
    {id:"q4", text:"Ù‚ÙˆÙ„Ù‡ ØªØ¹Ø§Ù„Ù‰: ï´¿ÙÙÙ„ÙØ§ Ø§Ù‚Ù’ØªÙØ­ÙÙ…Ù Ø§Ù„Ù’Ø¹ÙÙ‚ÙØ¨ÙØ©Ùï´¾ Ø§Ù„Ø¹Ù‚Ø¨Ø© Ù‡Ù†Ø§ ØªØ¹Ù†ÙŠ:", choices:[
      {label:"Ø£) Ø§Ù„Ø¬Ø¨Ù„", value:"a"},
      {label:"Ø¨) Ø§Ù„Ø¬Ù‡Ø§Ø¯", value:"b"},
      {label:"Ø¬) Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ø´Ø§Ù‚Ø© Ù…Ù† Ø§Ù„Ø·Ø§Ø¹Ø§Øª", value:"c"},
      {label:"Ø¯) Ø§Ù„Ù‡Ø¬Ø±Ø©", value:"d"},
    ], answer:"c"},
    {id:"q5", text:"Ù…Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ù€ Ø§Ù„Ø³Ø¨Ø¹ Ø§Ù„Ù…Ø«Ø§Ù†ÙŠØŸ", choices:[
      {label:"Ø£) Ø§Ù„Ø³Ø¨Ø¹ Ø§Ù„Ø·ÙˆØ§Ù„", value:"a"},
      {label:"Ø¨) Ø³ÙˆØ± Ø§Ù„Ù…ÙØµÙ„", value:"b"},
      {label:"Ø¬) Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©", value:"c"},
      {label:"Ø¯) Ø§Ù„Ø³Ø¨Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª", value:"d"},
    ], answer:"c"},
    {id:"q6", text:"Ù…Ø§Øª Ø±Ø¬Ù„ ÙˆØªØ±Ùƒ: (Ø²ÙˆØ¬Ø© â€“ Ø£Ù… â€“ Ø§Ø¨Ù†)ØŒ ÙÙ…Ø§ Ù†ØµÙŠØ¨ Ø§Ù„Ø²ÙˆØ¬Ø©ØŸ", choices:[
      {label:"Ø£) Ø§Ù„Ù†ØµÙ", value:"a"},
      {label:"Ø¨) Ø§Ù„Ø±Ø¨Ø¹", value:"b"},
      {label:"Ø¬) Ø§Ù„Ø«Ù…Ù†", value:"c"},
      {label:"Ø¯) Ø§Ù„Ø³Ø¯Ø³", value:"d"},
    ], answer:"c"},
    {id:"q7", text:"Ù…ØªÙ‰ ØªØ±Ø« Ø§Ù„Ø¬Ø¯Ø© Ø§Ù„Ø³Ø¯Ø³ØŸ", choices:[
      {label:"Ø£) Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø£Ø¨", value:"a"},
      {label:"Ø¨) Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø£Ù…", value:"b"},
      {label:"Ø¬) Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø§Ø¨Ù†", value:"c"},
      {label:"Ø¯) Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨Ù†Øª", value:"d"},
    ], answer:"b"},
    {id:"q8", text:"Ù…Ù† Ø£ØµØ­Ø§Ø¨ Ø§Ù„ÙØ±ÙˆØ¶ Ø§Ù„Ø°ÙŠÙ† ÙŠØ±Ø«ÙˆÙ† Ø§Ù„Ø«Ù„Ø«ØŸ", choices:[
      {label:"Ø£) Ø§Ù„Ø£Ù… ÙÙ‚Ø·", value:"a"},
      {label:"Ø¨) Ø§Ù„Ø£Ù… Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„ÙØ±Ø¹ Ø§Ù„ÙˆØ§Ø±Ø«", value:"b"},
      {label:"Ø¬) Ø§Ù„Ø£Ø¨ ÙÙ‚Ø·", value:"c"},
      {label:"Ø¯) Ø§Ù„Ø²ÙˆØ¬Ø©", value:"d"},
    ], answer:"b"},
    {id:"q9", text:"Ù…Ø§ØªØª Ø§Ù…Ø±Ø£Ø© ÙˆØªØ±ÙƒØª: (Ø²ÙˆØ¬ â€“ Ø¨Ù†Øª ÙˆØ§Ø­Ø¯Ø© â€“ Ø£Ø¨)ØŒ ÙÙƒÙ… Ù†ØµÙŠØ¨ Ø§Ù„Ø£Ø¨ØŸ", choices:[
      {label:"Ø£) Ø§Ù„Ø³Ø¯Ø³ ÙÙ‚Ø·", value:"a"},
      {label:"Ø¨) Ø§Ù„Ø³Ø¯Ø³ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ ØªØ¹ØµÙŠØ¨Ù‹Ø§", value:"b"},
      {label:"Ø¬) Ø§Ù„Ø«Ù„Ø«", value:"c"},
      {label:"Ø¯) Ù„Ø§ ÙŠØ±Ø«", value:"d"},
    ], answer:"b"},
    {id:"q10", text:"Ø£ÙŠÙ‘Ù Ù‡Ø¤Ù„Ø§Ø¡ ÙŠÙØ­Ø¬Ø¨ Ø­Ø¬Ø¨ Ø­Ø±Ù…Ø§Ù†ØŸ", choices:[
      {label:"Ø£) Ø§Ù„Ø£Ù…", value:"a"},
      {label:"Ø¨) Ø§Ù„Ø£Ø¨", value:"b"},
      {label:"Ø¬) Ø§Ù„Ø£Ø® Ù„Ø£Ù…", value:"c"},
      {label:"Ø¯) Ø§Ù„Ø²ÙˆØ¬", value:"d"},
    ], answer:"c"},
    {id:"q11", text:"Ù…Ø§ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§ØµØ·Ù„Ø§Ø­Ù‹Ø§ØŸ", choices:[
      {label:"Ø£) ÙƒÙ„Ø§Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ù†Ø²Ù„ ÙÙ‚Ø·", value:"a"},
      {label:"Ø¨) ÙƒÙ„Ø§Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…ØªØ¹Ø¨Ø¯ Ø¨ØªÙ„Ø§ÙˆØªÙ‡", value:"b"},
      {label:"Ø¬) ÙƒÙ„Ø§Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ù…Ø¹Ø¬Ø² ÙÙ‚Ø·", value:"c"},
      {label:"Ø¯) Ø§Ù„ÙˆØ­ÙŠ Ø§Ù„Ù…Ù†Ø²Ù„", value:"d"},
    ], answer:"b"},
    {id:"q12", text:"Ù…Ø§ Ø£ÙˆÙ„ Ù…Ø§ Ù†Ø²Ù„ Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", choices:[
      {label:"Ø£) Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©", value:"a"},
      {label:"Ø¨) Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø«Ø±", value:"b"},
      {label:"Ø¬) Ø£ÙˆÙ„ Ø®Ù…Ø³ Ø¢ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø¹Ù„Ù‚", value:"c"},
      {label:"Ø¯) Ø³ÙˆØ±Ø© Ø§Ù„Ù‚Ù„Ù…", value:"d"},
    ], answer:"c"},
    {id:"q13", text:"Ù…Ø§ Ø§Ù„Ù…Ù‚ØµÙˆØ¯ Ø¨Ø§Ù„Ù…ÙƒÙŠØŸ", choices:[
      {label:"Ø£) Ù…Ø§ Ù†Ø²Ù„ ÙÙŠ Ù…ÙƒØ© ÙÙ‚Ø·", value:"a"},
      {label:"Ø¨) Ù…Ø§ Ù†Ø²Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ù‡Ø¬Ø±Ø©", value:"b"},
      {label:"Ø¬) Ù…Ø§ Ù†Ø²Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ù‡Ø¬Ø±Ø©", value:"c"},
      {label:"Ø¯) Ù…Ø§ Ø®ÙˆØ·Ø¨ Ø¨Ù‡ Ø£Ù‡Ù„ Ù…ÙƒØ©", value:"d"},
    ], answer:"b"},
    {id:"q14", text:"Ø£ÙŠÙ‘ÙŒ Ù…Ù…Ø§ ÙŠÙ„ÙŠ Ù…Ù† Ø£Ù†ÙˆØ§Ø¹ Ø¹Ù„ÙˆÙ… Ø§Ù„Ù‚Ø±Ø¢Ù†ØŸ", choices:[
      {label:"Ø£) Ø¹Ù„Ù… Ø§Ù„Ø±Ø¬Ø§Ù„", value:"a"},
      {label:"Ø¨) Ø¹Ù„Ù… Ø§Ù„Ù†Ø§Ø³Ø® ÙˆØ§Ù„Ù…Ù†Ø³ÙˆØ®", value:"b"},
      {label:"Ø¬) Ø¹Ù„Ù… Ø§Ù„Ø¬Ø±Ø­ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„", value:"c"},
      {label:"Ø¯) Ø¹Ù„Ù… Ø§Ù„Ù…ØµØ·Ù„Ø­", value:"d"},
    ], answer:"b"},
    {id:"q15", text:"Ø§Ù„Ø­ÙƒÙ…Ø© Ù…Ù† Ù†Ø²ÙˆÙ„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ù…Ù†Ø¬Ù…Ù‹Ø§:", choices:[
      {label:"Ø£) Ø§Ù„ØªØ®ÙÙŠÙ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º", value:"a"},
      {label:"Ø¨) ØªØ«Ø¨ÙŠØª Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø¨ÙŠ ï·º", value:"b"},
      {label:"Ø¬) Ø§Ù„ØªØ¯Ø±Ø¬ ÙÙŠ Ø§Ù„ØªØ´Ø±ÙŠØ¹", value:"c"},
      {label:"Ø¯) Ø¬Ù…ÙŠØ¹ Ù…Ø§ Ø³Ø¨Ù‚", value:"d"},
    ], answer:"d"},

    // 5 ØµØ­/Ø®Ø·Ø£ (Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©) ØªØ±ØªÙŠØ¨: ØµØ­/Ø®Ø·Ø£/ØµØ­/Ø®Ø·Ø£/ØµØ­
    {id:"q16", text:"Ø´Ù‡Ø¯ Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø­Ø±Ø¨ Ø§Ù„ÙÙØ¬ÙØ§Ø± ÙˆÙ‡Ùˆ Ø´Ø§Ø¨ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¹Ø«Ø©.", choices:[
      {label:"ØµØ­", value:"a"},{label:"Ø®Ø·Ø£", value:"b"}
    ], answer:"a"},
    {id:"q17", text:"ÙˆÙÙ„ÙØ¯ Ø§Ù„Ù†Ø¨ÙŠ ï·º ÙÙŠ Ø¹Ø§Ù… Ø§Ù„ÙÙŠÙ„ Ø¨Ø¹Ø¯ Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ÙÙŠÙ„ Ø¨Ø´Ù‡Ø±ÙŠÙ† ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§.", choices:[
      {label:"ØµØ­", value:"a"},{label:"Ø®Ø·Ø£", value:"b"}
    ], answer:"b"},
    {id:"q18", text:"Ø§Ø³ØªÙ…Ø± Ù†Ø²ÙˆÙ„ Ø§Ù„ÙˆØ­ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¨ÙŠ ï·º Ø«Ù„Ø§Ø«Ù‹Ø§ ÙˆØ¹Ø´Ø±ÙŠÙ† Ø³Ù†Ø©.", choices:[
      {label:"ØµØ­", value:"a"},{label:"Ø®Ø·Ø£", value:"b"}
    ], answer:"a"},
    {id:"q19", text:"ÙƒØ§Ù†Øª Ø£ÙˆÙ„ Ù‡Ø¬Ø±Ø© ÙÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©.", choices:[
      {label:"ØµØ­", value:"a"},{label:"Ø®Ø·Ø£", value:"b"}
    ], answer:"b"},
    {id:"q20", text:"ÙƒØ§Ù† ØµÙ„Ø­ Ø§Ù„Ø­Ø¯ÙŠØ¨ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© Ù„Ù„Ù‡Ø¬Ø±Ø©.", choices:[
      {label:"ØµØ­", value:"a"},{label:"Ø®Ø·Ø£", value:"b"}
    ], answer:"a"},
  ];

  let SESSION = { civil_id:"", box_number:"", name:"", phone:"", status:"" };
  const $ = (id) => document.getElementById(id);
  const digits = (v) => String(v || "").replace(/[^\d]/g, "");

  function showMsg(el, ok, text){
    el.className = "msg " + (ok ? "ok" : "err");
    el.textContent = text;
    el.style.display = "block";
  }
  function hide(el){ el.classList.add("hidden"); }
  function show(el){ el.classList.remove("hidden"); }

  async function apiCall(bodyObj){
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify(bodyObj),
    });
    return await res.json();
  }

  function shakeOnce(el, cls){
    if (!el) return;
    el.classList.remove(cls);
    void el.offsetWidth;
    el.classList.add(cls);
    setTimeout(() => el.classList.remove(cls), 450);
  }

  function wireOptionSelectionUI(){
    document.querySelectorAll('.q').forEach(qEl => {
      qEl.querySelectorAll('input[type="radio"]').forEach(inp => {
        inp.addEventListener('change', () => {
          qEl.classList.remove('missing');
          const groupName = inp.name;
          document.querySelectorAll(`input[name="${groupName}"]`).forEach(i => {
            const label = i.closest('label.opt');
            if (!label) return;
            label.classList.toggle('selected', i.checked);
            const mark = label.querySelector('.mark');
            if (mark) mark.textContent = i.checked ? "âœ“" : "";
          });
        });
      });
    });
  }

  function renderQuestions(){
    $("qCount").textContent = QUESTIONS.length;
    $("passPct").textContent = PASS_PERCENT;

    const container = $("questions");
    container.innerHTML = "";

    QUESTIONS.forEach((q, idx) => {
      const div = document.createElement("div");
      div.className = "q";
      div.setAttribute("data-qid", q.id);

      const num = document.createElement("div");
      num.className = "q-num";
      num.textContent = String(idx + 1).padStart(2, "0");
      div.appendChild(num);

      const title = document.createElement("div");
      title.className = "q-title";
      title.textContent = `${idx+1}) ${q.text}`;
      div.appendChild(title);

      const opts = document.createElement("div");
      opts.className = "opts";

      q.choices.forEach(ch => {
        const label = document.createElement("label");
        label.className = "opt";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = q.id;
        input.value = ch.value;

        const text = document.createElement("div");
        text.className = "txt";
        text.textContent = ch.label;

        const mark = document.createElement("div");
        mark.className = "mark";
        mark.textContent = "";

        label.appendChild(input);
        label.appendChild(text);
        label.appendChild(mark);
        opts.appendChild(label);
      });

      div.appendChild(opts);
      container.appendChild(div);
    });

    wireOptionSelectionUI();
  }

  function collectAnswers(){
    document.querySelectorAll(".q.missing").forEach(el => el.classList.remove("missing"));

    const answers = {};
    const missingIds = [];

    for (const q of QUESTIONS){
      const chosen = document.querySelector(`input[name="${q.id}"]:checked`);
      if (!chosen) { missingIds.push(q.id); continue; }
      answers[q.id] = chosen.value;
    }

    if (missingIds.length){
      missingIds.forEach(id => {
        const card = document.querySelector(`.q[data-qid="${id}"]`);
        if (card) card.classList.add("missing");
      });
      return { ok:false, missingIds };
    }

    return { ok:true, answers };
  }

  function grade(answers){
    let correct = 0;
    QUESTIONS.forEach(q => {
      if (String(answers[q.id]).toLowerCase() === String(q.answer).toLowerCase()) correct++;
    });
    const total = QUESTIONS.length;
    const percent = Math.round((correct / total) * 100);
    const passed = percent >= PASS_PERCENT;
    return { correct, total, percent, passed };
  }

  function openApprovedView(messageText){
    $("apName").textContent  = SESSION.name  || "-";
    $("apCivil").textContent = SESSION.civil_id || "-";
    $("apBox").textContent   = SESSION.box_number || "-";
    $("apPhone").textContent = SESSION.phone || "-";

    $("approvedMsg").textContent = messageText || "âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ğŸŒŸ";

    hide($("gateCard"));
    hide($("quizCard"));
    show($("approvedCard"));

    $("approvedBtn").onclick = () => { window.location.href = "register.html"; };
  }

  async function gate(){
    const params = new URLSearchParams(window.location.search);
    const civil = digits(params.get("civil_id") || "");
    const box   = digits(params.get("box_number") || "");

    if (!civil || !box){
      showMsg($("gateMsg"), false, "Ù„Ø§ ÙŠÙ…ÙƒÙ† ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
      show($("backBtn"));
      $("backBtn").onclick = () => window.location.href = "register.html";
      return;
    }

    try{
      const data = await apiCall({ action:"checkAccess", civil_id: civil, box_number: box });

      if (!data.ok && data.code === "ALREADY_SUBMITTED") {
        SESSION.civil_id = civil;
        SESSION.box_number = box;
        SESSION.name = data.name || "";
        SESSION.phone = data.phone || "";
        SESSION.status = (data.status || "").trim();

        openApprovedView("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ğŸŒŸ");
        return;
      }

      if (!data.ok){
        showMsg($("gateMsg"), false, data.message || "ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­.");
        show($("backBtn"));
        $("backBtn").onclick = () => window.location.href =
          `register.html?civil_id=${encodeURIComponent(civil)}&box_number=${encodeURIComponent(box)}`;
        return;
      }

      SESSION.civil_id = civil;
      SESSION.box_number = box;
      SESSION.name = data.name || "";
      SESSION.phone = data.phone || "";
      SESSION.status = (data.status || "").trim();

      $("who").textContent = SESSION.name ? `Ù…Ø±Ø­Ø¨Ù‹Ø§: ${SESSION.name}` : "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ";

      hide($("gateCard"));
      show($("quizCard"));
      renderQuestions();
      updateDeadlineState();

    }catch(e){
      showMsg($("gateMsg"), false, "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.");
      show($("backBtn"));
      $("backBtn").onclick = () => window.location.href = "register.html";
      console.error(e);
    }
  }

  $("btnSubmit").addEventListener("click", async () => {
    const msgEl = $("quizMsg");
    msgEl.style.display = "none";

    if (isClosedNow()){
      showMsg(msgEl, false, "Ø¹Ø°Ø±Ù‹Ø§ØŒ Ø§Ù†ØªÙ‡Ù‰ Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª.");
      updateDeadlineState();
      return;
    }

    const got = collectAnswers();
    if (!got.ok){
      showMsg(msgEl, false, "Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
      const firstMissing = document.querySelector(`.q[data-qid="${got.missingIds[0]}"]`);
      if (firstMissing) {
        firstMissing.scrollIntoView({ behavior: "smooth", block: "center" });
        setTimeout(() => shakeOnce(firstMissing, "shake"), 250);
      }
      shakeOnce(msgEl, "shakeMsg");
      return;
    }

    const result = grade(got.answers);

    $("btnSubmit").disabled = true;
    $("btnSubmit").textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

    try{
      const payload = {
        action: "submitQuiz",
        quiz_id: QUIZ_ID,
        civil_id: SESSION.civil_id,
        box_number: SESSION.box_number,
        answers: got.answers,
        score: result.correct,
        total: result.total,
        percent: result.percent
      };

      const data = await apiCall(payload);

      if (!data.ok){
        showMsg(msgEl, false, data.message || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
        updateDeadlineState();
        return;
      }

      SESSION.status = (data.status || "").trim();
      openApprovedView("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©. Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙƒ ğŸŒŸ");

    }catch(e){
      showMsg(msgEl, false, "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.");
      console.error(e);
      updateDeadlineState();
    }
  });

  gate();
</script>
</body>
</html>


